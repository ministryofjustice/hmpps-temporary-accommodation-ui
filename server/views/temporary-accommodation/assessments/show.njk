{%- from "moj/components/identity-bar/macro.njk" import mojIdentityBar -%}
{% from "../../partials/breadCrumb.njk" import breadCrumb %}
{%- from "govuk/components/summary-list/macro.njk" import govukSummaryList -%}

{% extends "../../partials/layout.njk" %}

{% set pageTitle = applicationName + " - " + assessment.application.person.name + " referral" %}
{% set mainClasses = "app-container govuk-body" %}

{% block beforeContent %}
  {{ breadCrumb(assessment.application.person.name, [
    {title: 'Referrals', href: paths.assessments.index()}
  ]) }}
{% endblock %}

{% block content %}
  {% include "../../_messages.njk" %}

  <div class="moj-identity-bar">
    <div class="moj-identity-bar__container">
      <div class="moj-identity-bar__details">
        <span class="moj-identity-bar__title">
          <span class="govuk-caption-xl">Review referral</span>
          <h1 class="govuk-heading-xl">{{ assessment.application.person.name }}
            {{ assessmentStatusTag(assessment.status) | safe }}</h1>
        </span>
      </div>

      <div class="moj-identity-bar__actions">
        <div class="moj-identity-bar__menu">
          <div class="moj-button-menu">
            <div class="moj-button-menu__wrapper">
              {% for action in actions %}
                {% if action.newTab %}
                  <a href="{{ action.href }}" role="menuitem" draggable="false" class="moj-button-menu__item {{ action.classes }}" data-module="govuk-button" data-secondary="true" rel="noreferrer noopener" target="_blank">
                    {{ action.text }} (opens in new tab)
                  </a>
                {% else %}
                  <a href="{{ action.href }}" role="menuitem" draggable="false" class="moj-button-menu__item {{ action.classes }}" data-module="govuk-button" data-secondary="true">
                    {{ action.text }}
                  </a>
                {% endif %}
                </a>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="govuk-!-margin-4">
    {% for section in assessment.application.document.sections %}
      <h2 class="govuk-heading-l govuk-!-margin-top-3" >{{ section.title }}</h2>
      {% for task in section.tasks %}

        {{
          govukSummaryList({
            card: {
              title: {
                text: task.title
              }
              },
              rows: taskResponsesToSummaryListRowItems(task.content)
          })
        }}
      {% endfor %}
    {% endfor %}
  </div>

{% endblock %}

{% block extraScripts %}
  <script type="text/javascript" nonce="{{ cspNonce }}">
    new MOJFrontend.ButtonMenu({container: $('.moj-button-menu'), mq: "(min-width: 200em)", buttonText: "Update referral status", menuClasses: "moj-button-menu__wrapper--right"});
  </script>
{% endblock %}
