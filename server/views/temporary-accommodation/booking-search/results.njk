{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{%- from "moj/components/sub-navigation/macro.njk" import mojSubNavigation -%}
{% from "../components/ta-input/macro.njk" import taInput %}
{% extends "../../partials/layout.njk" %}
{% from "../../partials/breadCrumb.njk" import breadCrumb %}
{% from "../../partials/showErrorSummary.njk" import showErrorSummary %}
{% set pageTitle = "View bookings - " + applicationName %}
{% set mainClasses = "app-container govuk-body" %}

{% block beforeContent %}
  {{ breadCrumb('View bookings', []) }}
{% endblock %}

{% block content %}
  <h1 class="govuk-heading-l">{{ uiStatus | capitalize }} bookings</h1>

  {{ showErrorSummary(errorSummary) }}

  {{
    mojSubNavigation({
    label: 'Secondary navigation',
    items: subNavArr
    })
  }}

  <div class="govuk-template govuk-!-padding-8 govuk-!-padding-bottom-static-3 govuk-!-margin-bottom-8">
    <form action="{{ paths.bookings.search[uiStatus].index() }}" method="get">

      {{ taInput(
        {
          label: {
            classes: 'govuk-label--m',
            text: 'Search ' + uiStatus + ' bookings by CRN (case reference number)'
          },
          hint: {
            text: 'For example, XD7364CD'
          },
          fieldName: 'crn'
        },
        fetchContext()
      ) }}

      <div class="govuk-button-group">
        {{ govukButton({ text: "Search", attributes: { id: 'search-button' }, preventDoubleClick: true}) }}

        <a class="govuk-link" href="{{ paths.bookings.search[uiStatus].index() }}">Clear</a>
      </div>
    </form>
  </div>

  {% if (bookingTableRows|length > 0) or (not crn) %}
    {{
      govukTable({
        captionClasses: "govuk-table__caption--m",
        attributes: {
          'data-module': 'moj-sortable-table'
        },
        head: tableHeadings,
        rows: bookingTableRows
      })
    }}
  {% else %}
    <h2>There are no results for ‘{{ crn }}’ in {{ uiStatus }} bookings.</h2>

    <p>Check the other lists.</p>

    <p>If the booking is missing from every list, <a href="mailto:{{ PhaseBannerUtils.supportEmail }}">contact support</a> for help.</p>
  {% endif %}

  {% block extraScripts %}
    <script type="text/javascript" nonce="{{ cspNonce }}">
      $(document).ready(function () {
        window.MOJFrontend.initAll()
      })
    </script>
  {% endblock %}
{% endblock %}
